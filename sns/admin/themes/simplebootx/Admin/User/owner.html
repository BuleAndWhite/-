<admintpl file="header"/>
<style>

    .wrap select {
        width: 415px
    }

    .appmsg_content p.title {
        overflow: hidden;
        height: 25px;
        line-height: 25px;
    }

    .hidden {
        display: none !important;
        visibility: hidden !important;
    }

    .submsg-title {
        padding: 5px 14px;
    }

    .submsg-title img {
        width: 45px;
        height: 45px;
        float: right;
    }

    .weixin_modal {
        display: block;
        position: fixed;
        left: 50%;
        top: 50%;
        z-index: 10000;
        /*设定这个div的margin-top的负值为自身的高度的一半,margin-left的值也是自身的宽度的一半的负值.*/
        /*宽为400,那么margin-top为-200px*/
        /*高为200那么margin-left为-100px;*/
        margin: -200px 0 0 -350px;

    }

    .weixin_modal, .modal-backdrop {
        display: none
    }

    .modal-content {
        position: relative;
        background-color: #ffffff;
        border: 1px solid #999999;
        border: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 0px;
        -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
        box-shadow: 0 3px 9px rgba(0, 0, 0, 0.5);
        background-clip: padding-box;
        outline: 0;
    }

    .modal-backdrop {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background-color: #ccc;
    }

    .modal-backdrop.in {
        opacity: 0.3;
    }

    .modal-header {
        padding: 15px;
        border-bottom: 1px solid #e5e5e5;
        min-height: 16.42857143px;
        background: #fff;
    }

    .modal-header h3 {
        color: #323336;
        font-weight: 400;
        margin-top: 5px;
        margin-bottom: 5px;
        font-size: 18px;
    }

    .modal-dialog {
        width: 900px;
        margin: 30px auto;
    }

    button.close {
        padding: 0;
        cursor: pointer;
        background: transparent;
        border: 0;
        -webkit-appearance: none;
    }

    .close {
        float: right;
        font-size: 21px;
        font-weight: bold;
        line-height: 1;
        color: #000000;
        text-shadow: none;
        opacity: 0.2;
        width: 18px;
        filter: alpha(opacity=20);
    }

    .btn {
        display: inline-block;
        margin-bottom: 0;
        font-weight: normal;
        text-align: center;
        vertical-align: middle;
        touch-action: manipulation;
        cursor: pointer;
        background-image: none;
        border: 1px solid transparent;
        white-space: nowrap;
        font-size: 14px;
        line-height: 1.42857143;
        border-radius: 0px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .col-md-4 {
        width: 29%;
        float: left;
        padding-left: 15px;
        padding-right: 15px;
    }

    .row {
        margin-left: -15px;
        margin-right: -15px;
    }

    .appmsg {
        border: 1px solid #e7e7eb;
        margin-bottom: 10px;
    }

    .appmsg_content {
        padding: 0 14px;
        position: relative;
    }

    .appmsg_content .cover {
        width: 100%;
        height: 120px;
        overflow: hidden;
    }

    .appmsg_desc {
        max-height: 80px;
        overflow: hidden;
        padding: 5px 0 10px;
        word-wrap: break-word;
        /*     word-break: break-all; */
    }

    .appmsg_opr a {
        display: block;
        padding: 8px 0;
    }

    .appmsg_opr {
        background-color: #f4f4f4;
        border-top: 1px solid #e7e7eb;
        text-align: center;
    }

    .glyphicon {
        position: relative;
        top: 1px;
        display: inline-block;
        font-family: 'Glyphicons Halflings';
        font-style: normal;
        font-weight: normal;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
</style>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="javascript:;">列表</a></li>

    </ul>

    <form class="js-ajax-form" action="" method="post">

        <table class="table table-hover table-bordered table-list">
            <thead>
            <tr>
                <th width="80">编码</th>
                <th width="80">推广二维码</th>
            </tr>
            </thead>

            <foreach name="didList" item="vo">
                <tr>
                    <td>{$vo.did}</td>
                    <td><a href="{$vo.q_r_code}" download=""><img width="100" height="100"  src="{$vo.q_r_code}"/></a> </td>
                    <!--<td><a href="javascript:download('{$vo.q_r_code}');"><img width="100" height="100"  src="{$vo.q_r_code}"/></a> </td>-->
                </tr>
            </foreach>
            <script src="__PUBLIC__/js/jquery.ui.widget.js"></script>
            <script src="__PUBLIC__/js/jquery.iframe-transport.js"></script>
            <script src="__PUBLIC__/js/jquery.fileupload.js"></script>

            <script>
                //下载图片
                // function download(imageString) {
                //
                //     let imgData = imageString;
                //     this.downloadFile('tg.png', imgData);
                // }
                // function downloadFile(fileName, content) {
                //     let aLink = document.createElement('a');
                //     let blob = this.base64ToBlob(content); //new Blob([content]);
                //
                //     let evt = document.createEvent("HTMLEvents");
                //     evt.initEvent("click", true, true);//initEvent 不加后两个参数在FF下会报错  事件类型，是否冒泡，是否阻止浏览器的默认行为
                //     aLink.download = fileName;
                //     aLink.href = URL.createObjectURL(blob);
                //
                //     // aLink.dispatchEvent(evt);
                //     aLink.click()
                // }
                // function base64ToBlob(code) {
                //     let parts = code.split(';base64,');
                //     let contentType = parts[0].split(':')[1];
                //     let raw = window.atob(parts[1]);
                //     let rawLength = raw.length;
                //
                //     let uInt8Array = new Uint8Array(rawLength);
                //
                //     for (let i = 0; i < rawLength; ++i) {
                //         uInt8Array[i] = raw.charCodeAt(i);
                //     }
                //     return new Blob([uInt8Array], {type: contentType});
                // }
                function toEdit(id){

                    $('#fileupload'+id).click();
                    $('#fileupload'+id).fileupload({
                        dataType: 'json',
                        acceptFileTypes: /(\.|\/)(gif|jpe?g|png|mp4|sql|xls|xlsx)$/i,
                        maxFileSize: 10485761111,
                        progressall: function (e, data) {
//                                    console.log(data)
                            var progress = parseInt(data.loaded / data.total * 100, 10);
                            // $('#progress .bar').html(progress + '%');
                        },
                        done: function (e, data) {
//                                    console.log(data)
                            if (data.result.status == 1) {
                                // $(".control-group"+data.result.id).html("")
                                // $(".control-group"+data.result.id).append("<a href='http://www.zzf.com"+data.result.url+"' download>下载</a>");
                                // $('.save_paths').val(data.result.url);
                                // $('.size').val(data.result.file_size);
                                window.location.reload()
                            }
                            else {
                                alert(data.result.info);
                            }
                            setTimeout(function () {
                                $('#progress').hide();
                            }, 2000)
                        }
                    });
                }

            </script>
            <tfoot>
            <tr>
                <th width="80">编码</th>
                <th width="80">推广二维码</th>

            </tr>
            </tfoot>
        </table>

        <div class="pagination">{$page}</div>
    </form>
</div>

<div class="modal-backdrop  in"></div>
<script src="__PUBLIC__/js/common.js"></script>
<script>
    $(function () {
        $('button.close').click(function () {
            $('.modal-backdrop,.weixin_modal').hide();
        });
        var html = '<img src="__TMPL__/Public/assets/images/wheel_throbber.gif"> 正在加载...';
        $('.contentSof').click(function () {
            $('.modal-body').html(html);
            var id = $(this).attr("data-content-sof");

            $.get("{:U('Demand/select')}", {id: id}, function (data) {
                $('.modal-body').html(data.info);
            });
            $('.modal-backdrop,.weixin_modal').show();
        });
        $('.choose-media').live('click', function () {
            $('#comment').val($(this).attr('data-mid'));
            $('.modal-backdrop,.weixin_modal').hide();
        });
    })
</script>

<script>
    function refersh_window() {
        var refersh_time = getCookie('refersh_time');
        if (refersh_time == 1) {
            window.location = "{:U('ProjectList/index',$formget)}";
        }
    }

    setInterval(function () {
        refersh_window();
    }, 2000);
    $(function () {
        setCookie("refersh_time", 0);
        Wind.use('ajaxForm', 'artDialog', 'iframeTools', function () {
            //批量移动
            $('.js-articles-move').click(function (e) {
                var str = 0;
                var id = tag = '';
                $("input[name='ids[]']").each(function () {
                    if ($(this).attr('checked')) {
                        str = 1;
                        id += tag + $(this).val();
                        tag = ',';
                    }
                });
                if (str == 0) {
                    art.dialog.through({
                        id: 'error',
                        icon: 'error',
                        content: '您没有勾选信息，无法进行操作！',
                        cancelVal: '关闭',
                        cancel: true
                    });
                    return false;
                }
                var $this = $(this);
                art.dialog.open("__ROOT__/index.php?g=portal&m=AdminPost&a=move&ids=" + id, {
                    title: "批量移动",
                    width: "80%"
                });
            });
        });
    });
</script>
</body>
</html>